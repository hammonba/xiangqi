(ns uix.view-board
  (:require [clojure.string :as string]
            ["@material-ui/core/styles" :as styles]
            ["react-router-dom" :as router]
            [xframe.core.alpha :as xf :refer [<sub]]
            [xiangqi.board-layout :as board-layout]
            [uix.core.alpha :as uix]))

(def board-lines
  [:g {:id "board-lines" :stroke "black" :stroke-width "0.03"}
   [:line {:y1 0 :y2 4 :x1 0 :x2 0}]
   [:line {:y1 0 :y2 4 :x1 1 :x2 1}]
   [:line {:y1 0 :y2 4 :x1 2 :x2 2}]
   [:line {:y1 0 :y2 4 :x1 3 :x2 3}]
   [:line {:y1 0 :y2 4 :x1 4 :x2 4}]
   [:line {:y1 0 :y2 4 :x1 5 :x2 5}]
   [:line {:y1 0 :y2 4 :x1 6 :x2 6}]
   [:line {:y1 0 :y2 4 :x1 7 :x2 7}]
   [:line {:y1 0 :y2 4 :x1 8 :x2 8}]

   [:line {:y1 0 :y2 0 :x1 0 :x2 8}]
   [:line {:y1 1 :y2 1 :x1 0 :x2 8}]
   [:line {:y1 2 :y2 2 :x1 0 :x2 8}]
   [:line {:y1 3 :y2 3 :x1 0 :x2 8}]
   [:line {:y1 4 :y2 4 :x1 0 :x2 8}]
   [:line {:y1 5 :y2 5 :x1 0 :x2 8}]
   [:line {:y1 6 :y2 6 :x1 0 :x2 8}]
   [:line {:y1 7 :y2 7 :x1 0 :x2 8}]
   [:line {:y1 8 :y2 8 :x1 0 :x2 8}]
   [:line {:y1 9 :y2 9 :x1 0 :x2 8}]

   [:line {:y1 5 :y2 9 :x1 0 :x2 0}]
   [:line {:y1 5 :y2 9 :x1 1 :x2 1}]
   [:line {:y1 5 :y2 9 :x1 2 :x2 2}]
   [:line {:y1 5 :y2 9 :x1 3 :x2 3}]
   [:line {:y1 5 :y2 9 :x1 4 :x2 4}]
   [:line {:y1 5 :y2 9 :x1 5 :x2 5}]
   [:line {:y1 5 :y2 9 :x1 6 :x2 6}]
   [:line {:y1 5 :y2 9 :x1 7 :x2 7}]
   [:line {:y1 5 :y2 9 :x1 8 :x2 8}]

   [:line {:x1 3 :x2 5 :y1 0 :y2 2}]
   [:line {:x1 3 :x2 5 :y1 2 :y2 0}]
   [:line {:x1 3 :x2 5 :y1 7 :y2 9}]
   [:line {:x1 3 :x2 5 :y1 9 :y2 7}]

   [:rect {:x "3.05" :y "0.05" :width "1.90" :height "1.90" :fill "none" :stroke-width "0.02" :stroke "black"}]
   [:rect {:x "3.05" :y "7.05" :width "1.90" :height "1.90" :fill "none" :stroke-width "0.02" :stroke "black"}]
   [:rect {:x "-0.45" :y "4.05" :width "8.9" :height "0.9" :stroke-width "0.1" :stroke "blue" :fill "none"}]])

(def chu
  [:g {:id "chu" :transform "scale(0.001, -0.001) translate(-500, -400)" :class "river"}
   [:path {:d "M 399 611 Q 424 618 452 624 Q 486 633 492 638 Q 499 645 495 653 Q 488 663 461 669 Q 419 675 403 660 L 364 646 Q 282 624 219 614 Q 185 607 210 593 Q 252 572 302 588 Q 317 592 337 596 L 399 611 Z"}]
   [:path {:d "M 396 562 Q 397 587 399 611 L 403 660 Q 406 732 427 767 Q 433 776 422 788 Q 373 827 348 818 Q 335 814 341 800 Q 363 764 364 646 L 362 550 Q 358 480 352 449 Q 351 439 366 402 Q 375 387 388 395 Q 395 401 396 534 L 396 562 Z"}]
   [:path {:d "M 337 596 Q 327 520 168 386 Q 155 376 168 375 Q 177 374 207 390 Q 243 406 274 436 Q 328 488 362 550 C 398 614 344 633 337 596 Z"}]
   [:path {:d "M 396 534 Q 450 497 451 495 Q 452 495 456 495 Q 463 496 466 504 Q 467 514 461 532 Q 457 545 436 553 Q 417 559 396 562 C 366 566 371 551 396 534 Z"}]
   [:path {:d "M 681 649 Q 822 685 823 686 Q 832 693 827 701 Q 820 711 794 718 Q 766 722 739 712 Q 712 702 685 693 L 645 681 Q 591 669 532 662 Q 498 656 523 641 Q 557 623 610 632 L 681 649 Z"}]
   [:path {:d "M 679 615 Q 679 633 681 649 L 685 693 Q 694 769 710 798 Q 716 807 706 820 Q 657 859 631 850 Q 619 846 625 833 Q 647 796 645 736 Q 645 708 645 681 L 643 613 Q 639 538 632 506 Q 631 494 646 458 Q 655 443 668 451 Q 678 460 679 530 Q 679 560 678 591 L 679 615 Z"}]
   [:path {:d "M 610 632 Q 577 553 472 465 Q 460 455 472 455 Q 479 454 507 469 Q 538 482 564 506 Q 621 563 643 613 C 659 647 630 677 610 632 Z"}]
   [:path {:d "M 678 591 Q 729 555 791 502 Q 804 489 817 486 Q 824 486 828 494 Q 837 506 823 538 Q 810 577 679 615 C 650 623 654 608 678 591 Z"}]
   [:path {:d "M 512 365 Q 617 393 653 390 Q 669 386 670 379 Q 670 373 635 313 Q 628 301 633 296 Q 640 292 656 302 Q 711 330 755 338 Q 791 345 790 354 Q 789 364 720 420 Q 696 441 616 421 Q 579 417 384 374 Q 344 365 302 359 Q 271 355 291 338 Q 324 313 358 323 Q 437 353 474 357 L 512 365 Z"}]
   [:path {:d "M 536 101 Q 539 158 542 206 L 544 238 Q 547 335 547 337 L 546 338 Q 530 356 512 365 C 486 380 463 385 474 357 Q 486 333 489 250 Q 489 205 490 122 C 490 92 534 71 536 101 Z"}]
   [:path {:d "M 542 206 Q 543 206 550 206 Q 623 216 677 221 Q 702 225 693 239 Q 681 255 653 261 Q 611 268 544 238 C 517 226 512 206 542 206 Z"}]
   [:path {:d "M 383 181 Q 396 197 410 212 Q 422 224 409 240 Q 370 279 345 277 Q 335 276 335 261 Q 336 161 215 58 Q 185 34 170 20 Q 160 5 176 9 Q 227 9 321 105 Q 355 147 366 161 L 383 181 Z"}]
   [:path {:d "M 366 161 Q 427 118 491 75 Q 490 75 491 74 Q 687 -50 719 -53 Q 783 -53 892 -7 Q 911 -1 911 5 Q 912 12 895 15 Q 832 25 759 34 Q 654 49 536 101 L 490 122 Q 471 132 450 143 Q 410 168 383 181 C 356 195 341 178 366 161 Z"}]])

(def river
  [:g {:id "river" :transform "scale(0.001, -0.001) translate(-500, -400)" :class "river"}
   [:path {:d "M 253 745 Q 275 726 301 701 Q 317 686 335 688 Q 347 689 352 704 Q 356 722 345 755 Q 338 774 308 785 Q 233 807 220 799 Q 214 795 217 780 Q 221 767 253 745 Z"}]
   [:path {:d "M 149 549 Q 195 503 231 490 Q 249 489 258 504 Q 264 520 259 539 Q 249 566 227 579 Q 191 597 143 597 Q 134 597 129 593 Q 122 592 126 577 Q 129 564 149 549 Z"}]
   [:path {:d "M 145 194 Q 132 190 135 172 Q 147 97 184 75 Q 191 68 202 71 Q 211 72 211 99 Q 217 142 309 383 Q 316 399 315 406 Q 314 416 305 409 Q 295 402 282 385 Q 230 303 183 232 Q 171 213 145 194 Z"}]
   [:path {:d "M 743 662 Q 813 668 927 669 Q 948 670 952 679 Q 958 691 940 705 Q 883 744 846 734 Q 711 703 344 647 Q 322 644 339 627 Q 370 599 411 608 Q 537 644 690 658 L 743 662 Z"}]
   [:path {:d "M 419 504 Q 406 508 380 512 Q 368 516 365 510 Q 358 504 367 488 Q 392 437 409 353 Q 413 328 428 311 Q 446 289 451 305 Q 455 315 454 332 L 451 365 Q 436 450 435 475 C 433 500 433 500 419 504 Z"}]
   [:path {:d "M 583 385 Q 601 455 622 477 Q 646 504 621 518 Q 602 530 573 548 Q 552 558 511 533 Q 472 517 419 504 C 390 497 406 467 435 475 Q 457 482 517 494 Q 538 498 543 490 Q 550 486 543 454 Q 536 423 528 384 C 522 355 575 356 583 385 Z"}]
   [:path {:d "M 454 332 Q 461 331 471 333 Q 511 342 601 349 Q 611 350 612 360 Q 612 367 583 385 C 568 395 557 392 528 384 Q 483 372 451 365 C 422 359 424 334 454 332 Z"}]
   [:path {:d "M 661 92 Q 639 102 609 111 Q 597 115 597 108 Q 596 101 606 89 Q 667 29 705 -19 Q 717 -29 732 -12 Q 775 42 774 125 Q 762 422 769 544 Q 770 572 773 600 Q 780 628 773 639 Q 766 649 743 662 C 718 678 677 685 690 658 Q 691 654 697 645 Q 709 620 708 577 Q 711 441 709 132 Q 708 101 698 90 Q 688 84 661 92 Z"}]])

(def han
  [:g {:id "han" :transform "scale(0.001, -0.001) translate(-500, -400)" :class "river"}
   [:path {:d "M 226 723 Q 251 699 277 672 Q 292 656 310 657 Q 323 658 328 673 Q 334 689 324 724 Q 318 743 287 758 Q 209 788 196 779 Q 190 775 192 760 Q 196 747 226 723 Z"}]
   [:path {:d "M 128 533 Q 176 478 215 457 Q 231 454 242 469 Q 249 482 247 502 Q 235 550 145 575 Q 144 576 143 576 Q 124 580 114 577 Q 107 576 109 562 Q 110 549 128 533 Z"}]
   [:path {:d "M 130 145 Q 117 141 121 123 Q 143 44 177 30 Q 184 23 195 26 Q 202 29 203 55 Q 204 94 287 359 Q 293 375 292 382 Q 291 392 281 385 Q 269 376 167 189 Q 157 167 130 145 Z"}]
   [:path {:d "M 683 712 Q 744 722 798 728 Q 808 727 817 739 Q 818 749 796 760 Q 766 782 693 758 L 633 743 Q 624 743 525 721 L 477 715 Q 429 712 376 703 Q 349 700 370 683 Q 398 659 438 668 Q 459 674 485 677 L 526 685 Q 572 695 631 704 L 683 712 Z"}]
   [:path {:d "M 525 721 Q 525 787 521 791 Q 520 792 519 792 Q 506 802 481 809 Q 462 813 445 804 Q 436 797 449 785 Q 465 761 477 715 L 485 677 Q 501 575 509 560 Q 516 551 522 558 Q 525 562 528 572 L 530 610 Q 529 625 528 638 Q 527 663 526 685 L 525 721 Z"}]
   [:path {:d "M 664 635 Q 673 675 683 712 L 693 758 Q 694 762 696 767 Q 696 771 713 811 Q 717 820 701 836 Q 671 857 650 864 Q 637 868 628 862 Q 621 856 626 842 Q 636 823 636 809 Q 635 778 633 743 L 631 704 Q 627 670 623 633 C 620 603 657 606 664 635 Z"}]
   [:path {:d "M 581 586 Q 615 593 685 599 Q 695 600 696 609 Q 697 616 668 634 Q 667 635 664 635 L 623 633 Q 571 618 530 610 C 478 600 506 571 581 586 Z"}]
   [:path {:d "M 435 498 Q 431 507 385 511 Q 373 514 371 508 Q 365 502 374 488 Q 399 446 418 376 Q 422 355 436 342 Q 454 323 458 337 Q 459 344 460 355 L 456 385 Q 444 440 441 466 L 435 498 Z"}]
   [:path {:d "M 767 433 Q 788 475 813 488 Q 831 504 817 522 Q 802 535 753 562 Q 737 569 715 563 Q 666 544 618 531 L 559 517 Q 498 507 435 498 C 405 494 412 459 441 466 Q 448 467 459 471 Q 508 481 560 491 L 613 501 Q 649 508 685 516 Q 713 523 726 511 Q 732 505 729 492 Q 722 461 713 435 C 704 406 753 407 767 433 Z"}]
   [:path {:d "M 610 379 Q 682 391 780 400 Q 790 401 792 409 Q 792 416 767 433 C 752 444 742 441 713 435 Q 658 423 610 412 L 562 402 Q 505 393 456 385 C 426 380 430 355 460 355 Q 466 354 476 356 Q 510 365 561 372 L 610 379 Z"}]
   [:path {:d "M 604 282 Q 668 294 725 302 Q 750 306 741 320 Q 731 336 703 341 Q 667 345 607 325 L 558 314 Q 494 301 436 286 Q 418 282 440 266 Q 452 257 555 274 L 604 282 Z"}]
   [:path {:d "M 623 185 Q 708 195 831 197 Q 892 194 900 206 Q 904 216 888 230 Q 837 266 801 258 Q 725 240 594 219 L 545 211 Q 436 195 312 178 Q 291 175 307 159 Q 320 146 338 141 Q 359 137 374 141 Q 447 162 530 172 L 586 181 L 588 181 L 623 185 Z"}]
   [:path {:d "M 594 219 Q 600 250 604 282 L 607 325 Q 608 353 610 379 L 610 412 Q 610 437 610 459 Q 610 480 613 501 L 618 531 Q 619 538 623 547 Q 627 559 619 565 Q 604 577 581 586 C 554 599 509 595 528 572 Q 555 545 559 517 L 560 491 Q 561 445 562 402 L 561 372 Q 560 342 558 314 L 555 274 Q 554 267 553 257 Q 552 233 545 211 L 530 172 Q 482 97 402 57 Q 368 41 318 20 Q 306 16 302 13 Q 298 9 312 5 Q 405 -1 524 80 Q 539 92 551 106 Q 575 137 586 181 L 594 219 Z"}]
   [:path {:d "M 588 181 Q 589 180 591 178 Q 720 13 757 2 Q 808 -16 932 8 Q 951 9 953 15 Q 954 22 940 28 Q 760 86 698 130 Q 653 158 623 185 C 600 205 569 204 588 181 Z"}]])

(def border
  [:g {:id "border" :transform "scale(0.001, -0.001) translate(-500, -400)" :class "river"}
   [:path {:d "M 293 779 Q 281 785 248 787 Q 235 788 233 784 Q 227 777 237 762 Q 276 692 303 576 Q 309 540 331 518 Q 350 499 354 514 Q 355 520 356 526 L 355 557 Q 355 563 308 742 C 300 771 299 777 293 779 Z"}]
   [:path {:d "M 611 554 Q 627 526 644 517 Q 654 507 673 529 Q 689 554 731 691 Q 743 725 770 750 Q 785 763 773 778 Q 757 797 713 829 Q 695 838 627 825 Q 513 812 413 796 Q 349 786 293 779 C 263 775 279 735 308 742 Q 368 757 458 770 L 500 776 Q 651 800 670 780 Q 682 764 678 747 Q 642 599 621 585 C 605 563 605 563 611 554 Z"}]
   [:path {:d "M 517 660 Q 562 669 603 673 Q 625 677 617 689 Q 607 702 583 707 Q 561 711 522 701 Q 521 701 520 700 L 469 687 Q 417 675 371 664 Q 355 661 374 646 Q 386 639 409 642 Q 440 648 470 652 L 517 660 Z"}]
   [:path {:d "M 513 581 Q 514 624 517 660 L 520 700 Q 520 724 522 733 Q 531 754 500 776 C 476 794 451 799 458 770 Q 465 745 469 687 L 470 652 Q 470 619 471 573 C 472 543 512 551 513 581 Z"}]
   [:path {:d "M 549 549 Q 577 553 611 554 C 641 555 644 566 621 585 Q 617 589 612 592 Q 591 604 513 581 L 471 573 Q 410 564 355 557 C 325 553 326 525 356 526 Q 365 526 377 527 L 409 533 Q 452 542 523 547 L 549 549 Z"}]
   [:path {:d "M 377 527 Q 377 449 220 325 Q 216 324 214 321 Q 171 287 63 226 Q 54 223 64 219 Q 121 213 257 304 Q 377 410 411 446 Q 420 462 440 474 Q 447 477 448 487 Q 448 496 439 508 Q 421 532 409 533 C 382 546 379 548 377 527 Z"}]
   [:path {:d "M 523 547 Q 526 540 535 530 Q 637 409 748 300 Q 790 254 957 282 Q 976 283 977 289 Q 980 296 965 302 Q 773 378 746 396 Q 656 450 552 547 Q 549 548 549 549 C 526 569 506 572 523 547 Z"}]
   [:path {:d "M 354 333 Q 379 296 358 194 Q 331 104 269 59 Q 256 49 243 38 Q 231 29 243 27 Q 285 27 342 79 Q 403 137 415 227 Q 430 300 433 306 Q 440 322 426 330 Q 381 358 360 351 Q 348 347 354 333 Z"}]
   [:path {:d "M 556 378 Q 580 339 563 105 Q 562 96 561 87 Q 561 65 557 54 Q 545 2 600 -55 Q 601 -56 604 -58 Q 616 -59 621 -46 Q 633 -13 628 18 Q 618 297 625 348 Q 626 361 620 366 Q 595 387 576 396 Q 563 399 554 391 Q 548 388 556 378 Z"}]]
  )

(defn player-boundary
  [{:board/keys [player]}]
  [:g {:id "boundary" :class (board-layout/boundary-class player)}
   [:rect {:x -0.2 :y -0.2 :width 8.4 :height 0.2}]
   [:rect {:x -0.2 :y -0.2 :width 0.2 :height 4.2}]
   [:rect {:x -0.2 :y 5 :width 0.2 :height 4.2}]
   [:rect {:x -0.2 :y 9 :width 8.4 :height 0.2}]
   [:rect {:x 8 :y -0.2 :width 0.2 :height 4.2}]
   [:rect {:x 8 :y 5 :width 0.2 :height 4.2}]])

(def counter
  [:circle {:id "counter" :cx 0 :cy 0 :r "0.5" :class "counter"}])

(def red-soldier
  [:g {:id "red-soldier" :class "red-piece"}
   counter
   [:g {:transform "scale(0.001, -0.001) translate(-500, -400)"}
    [:path {:d "M 383 657 Q 524 690 592 719 Q 644 737 689 743 Q 708 743 713 752 Q 717 764 705 778 Q 683 797 633 819 Q 617 829 601 828 Q 592 824 591 812 Q 587 772 368 677 C 341 665 354 650 383 657 Z"}]
    [:path {:d "M 385 545 Q 384 614 386 633 Q 387 646 383 657 C 381 668 381 668 368 677 Q 340 699 306 707 Q 288 713 278 705 Q 268 698 277 678 Q 305 632 318 581 Q 328 529 352 318 C 355 288 405 293 402 323 Q 392 432 387 507 L 385 545 Z"}]
    [:path {:d "M 618 531 Q 756 558 762 564 Q 772 573 767 582 Q 760 595 727 605 Q 700 611 591 581 Q 486 556 385 545 C 355 542 357 510 387 507 Q 426 501 524 515 Q 546 519 572 523 L 618 531 Z"}]
    [:path {:d "M 619 351 Q 646 457 661 487 Q 665 496 649 512 Q 633 524 618 531 C 591 544 560 550 572 523 Q 572 522 574 518 Q 589 494 576 345 C 573 315 612 322 619 351 Z"}]
    [:path {:d "M 352 318 Q 234 308 106 292 Q 84 291 100 271 Q 116 255 135 249 Q 159 243 176 248 Q 425 311 849 312 Q 874 312 899 311 Q 921 310 927 320 Q 933 333 915 348 Q 857 393 816 384 Q 737 369 619 351 L 576 345 Q 539 341 497 335 Q 451 331 402 323 L 352 318 Z"}]
    [:path {:d "M 351 201 Q 275 125 153 42 Q 138 29 155 22 Q 203 22 344 109 Q 404 154 427 159 Q 449 166 444 187 Q 437 205 401 239 Q 389 251 376 249 Q 358 245 362 229 Q 366 213 351 201 Z"}]
    [:path {:d "M 598 200 Q 668 133 750 35 Q 768 11 786 5 Q 796 4 805 15 Q 821 30 808 82 Q 795 148 601 236 Q 591 243 588 228 Q 587 212 598 200 Z"}]]])

(def black-private
  [:g {:id "black-private" :class "black-piece"}
   counter
   [:g {:transform "scale(0.001, -0.001) translate(-500, -400)"}
    [:path {:d "M 479 820 Q 530 772 562 763 Q 578 762 587 776 Q 591 791 587 808 Q 569 850 488 862 Q 470 866 461 861 Q 454 858 458 846 Q 461 833 479 820 Z"}]
    [:path {:d "M 311 695 Q 275 691 300 673 Q 339 651 411 660 Q 534 678 664 697 Q 728 709 737 717 Q 746 724 742 732 Q 736 745 708 753 Q 675 762 591 735 Q 440 702 311 695 Z"}]
    [:path {:d "M 366 501 Q 394 550 419 580 Q 428 590 416 604 Q 380 632 358 630 Q 348 629 350 616 Q 359 534 271 438 Q 255 429 229 394 Q 222 381 235 385 Q 250 386 271 403 Q 320 439 353 482 L 366 501 Z"}]
    [:path {:d "M 353 482 Q 357 476 369 466 Q 435 405 441 403 Q 448 403 454 413 Q 458 423 453 445 Q 447 472 368 501 L 366 501 C 337 507 335 506 353 482 Z"}]
    [:path {:d "M 543 441 Q 585 462 633 522 L 647 542 Q 671 584 701 628 Q 710 638 697 652 Q 660 679 636 677 Q 626 676 628 662 Q 640 592 563 490 Q 554 484 528 451 C 509 428 517 427 543 441 Z"}]
    [:path {:d "M 633 522 Q 639 516 652 505 Q 692 474 734 435 Q 744 425 757 426 Q 766 426 769 437 Q 773 447 766 471 Q 757 510 649 542 L 647 542 C 618 548 611 543 633 522 Z"}]
    [:path {:d "M 548 310 Q 605 316 901 315 Q 925 315 931 325 Q 938 338 918 355 Q 843 412 799 390 Q 700 374 550 353 L 493 346 Q 318 327 115 306 Q 90 305 108 283 Q 142 249 190 258 Q 334 295 493 306 L 548 310 Z"}]
    [:path {:d "M 495 -24 Q 499 -48 506 -57 Q 512 -64 519 -62 Q 546 -44 546 116 Q 545 159 548 310 L 550 353 Q 550 372 553 383 Q 560 429 548 439 Q 545 440 543 441 L 528 451 Q 498 470 476 459 Q 467 452 474 441 Q 492 411 493 346 L 493 306 Q 493 -7 495 -24 Z"}]]])

(def red-cannon
  [:g {:id "red-cannon" :class "red-piece"}
   counter
   [:g {:transform "scale(0.001, -0.001) translate(-500, -400)"}
    [:path {:d "M 146 573 Q 140 512 123 455 Q 111 422 138 393 Q 150 378 166 396 Q 205 447 185 527 Q 181 558 168 579 Q 161 586 156 585 Q 149 581 146 573 Z"}]
    [:path {:d "M 306 524 Q 343 545 365 559 Q 410 595 435 603 Q 453 610 444 625 Q 434 638 414 651 Q 395 663 385 661 Q 375 660 378 649 Q 379 624 338 580 Q 322 564 307 545 C 288 522 280 509 306 524 Z"}]
    [:path {:d "M 295 322 Q 301 388 306 524 L 307 545 Q 308 656 332 723 Q 339 736 328 747 Q 306 765 269 775 Q 245 781 237 774 Q 228 767 236 756 Q 293 668 246 303 Q 219 180 165 111 Q 140 83 106 51 Q 96 42 96 38 Q 97 34 108 36 Q 121 32 150 48 Q 268 105 291 296 L 295 322 Z"}]
    [:path {:d "M 291 296 Q 295 290 304 282 Q 332 252 363 216 Q 372 206 384 204 Q 391 203 397 213 Q 403 223 399 247 Q 396 269 368 288 Q 307 321 295 322 C 266 328 273 320 291 296 Z"}]
    [:path {:d "M 541 588 Q 598 675 619 712 Q 634 745 648 761 Q 657 773 651 786 Q 645 799 614 819 Q 586 835 566 832 Q 547 828 558 807 Q 579 774 520 644 Q 492 586 452 520 Q 442 508 441 502 Q 438 490 453 494 Q 471 501 519 558 L 541 588 Z"}]
    [:path {:d "M 519 558 Q 520 558 524 556 Q 549 541 569 549 Q 756 610 774 594 Q 787 576 781 529 Q 772 399 744 341 Q 731 311 705 314 Q 687 318 671 324 Q 647 334 663 308 Q 699 266 714 234 Q 738 212 757 234 Q 788 259 809 305 Q 833 357 839 516 Q 842 571 859 600 Q 872 613 864 624 Q 854 636 801 656 Q 779 663 760 649 Q 711 616 541 588 C 511 583 492 570 519 558 Z"}]
    [:path {:d "M 618 329 Q 637 390 657 408 Q 679 432 657 446 Q 639 456 614 473 Q 596 483 554 460 Q 515 445 472 437 C 443 431 458 402 487 410 Q 497 413 561 427 Q 580 431 586 423 Q 589 420 569 332 C 562 303 609 300 618 329 Z"}]
    [:path {:d "M 471 280 Q 484 274 500 279 Q 540 289 630 299 Q 640 300 641 309 Q 641 316 618 329 C 598 340 598 340 569 332 Q 517 317 473 307 C 444 300 443 290 471 280 Z"}]
    [:path {:d "M 958 105 Q 946 139 936 240 Q 936 256 929 262 Q 923 266 917 248 Q 883 142 861 110 Q 840 85 783 69 Q 651 35 539 72 Q 496 91 485 117 Q 458 171 471 280 L 473 307 Q 477 353 487 405 Q 487 408 487 410 C 490 428 490 428 472 437 Q 462 446 447 450 Q 435 454 428 449 Q 422 446 427 430 Q 439 394 436 361 Q 424 156 442 100 Q 446 69 477 43 Q 591 -39 824 8 Q 831 11 841 12 Q 896 28 950 65 Q 969 78 958 105 Z"}]]]
  )

(def black-catapult
  [:g {:id "black-catapult" :class "black-piece"}
   counter
   [:g {:transform "scale(0.001, -0.001) translate(-500, -400)"}
    [:path {:d "M 284 581 Q 443 626 449 631 Q 458 640 452 648 Q 445 660 414 665 Q 383 669 353 655 Q 313 639 269 625 Q 220 612 163 603 Q 126 594 154 579 Q 181 564 230 567 L 284 581 Z"}]
    [:path {:d "M 237 375 Q 264 432 299 521 Q 312 557 313 559 Q 303 577 284 581 C 256 592 224 596 230 567 Q 245 516 194 387 L 179 354 Q 113 246 47 159 Q 40 153 51 152 Q 105 170 193 296 Q 193 299 196 301 L 237 375 Z"}]
    [:path {:d "M 194 387 Q 191 388 187 389 Q 175 392 173 387 Q 167 383 174 367 Q 175 363 179 354 L 196 301 Q 206 259 215 202 Q 216 171 234 151 Q 249 130 254 145 Q 261 164 256 202 L 251 235 Q 238 316 235 346 L 194 387 Z"}]
    [:path {:d "M 385 260 Q 404 332 426 353 Q 447 377 425 390 Q 407 400 382 417 Q 364 429 323 403 Q 284 388 237 375 C 206 366 206 339 235 346 Q 241 347 249 350 Q 289 360 325 369 Q 349 375 354 366 Q 361 360 353 328 Q 346 298 337 263 C 330 234 377 231 385 260 Z"}]
    [:path {:d "M 256 202 Q 265 201 276 204 Q 315 216 399 229 Q 409 230 410 240 Q 410 247 385 260 L 337 263 Q 333 263 330 261 Q 287 245 251 235 C 222 227 226 203 256 202 Z"}]
    [:path {:d "M 550 595 Q 587 641 630 709 Q 648 743 664 759 Q 674 771 668 784 Q 664 797 634 819 Q 606 837 587 836 Q 568 833 577 811 Q 589 789 581 770 Q 559 704 524 642 Q 490 582 442 516 Q 432 506 430 498 Q 427 488 441 490 Q 466 496 535 577 L 550 595 Z"}]
    [:path {:d "M 535 577 Q 541 573 552 568 Q 574 555 592 561 Q 781 615 793 599 Q 803 586 800 548 Q 796 446 773 400 Q 757 369 730 372 Q 718 372 707 373 Q 682 380 700 357 Q 728 321 741 295 Q 760 276 778 293 Q 835 335 854 482 Q 858 578 879 603 Q 891 616 884 626 Q 875 636 824 657 Q 805 664 786 651 Q 767 639 691 620 Q 615 601 550 595 C 520 592 509 591 535 577 Z"}]
    [:path {:d "M 655 337 Q 674 406 695 427 Q 714 449 695 462 Q 679 472 654 488 Q 638 497 621 487 Q 600 474 572 464 Q 547 457 517 448 C 488 439 504 414 532 424 Q 535 427 603 442 Q 624 446 629 439 Q 635 433 627 404 Q 620 376 610 343 C 601 314 647 308 655 337 Z"}]
    [:path {:d "M 514 293 Q 527 287 544 290 Q 583 299 666 307 Q 676 308 676 317 Q 676 324 655 337 L 610 343 Q 607 343 604 341 Q 555 326 517 318 C 488 312 486 304 514 293 Z"}]
    [:path {:d "M 517 448 Q 507 457 491 463 Q 478 467 471 462 Q 464 458 469 441 Q 481 404 478 369 Q 463 162 481 104 Q 485 74 514 49 Q 604 -26 818 2 Q 837 6 859 11 Q 911 26 962 61 Q 983 77 969 104 Q 956 125 937 192 Q 936 208 929 214 Q 923 218 918 199 Q 888 126 871 104 Q 853 82 800 68 Q 677 38 576 78 Q 536 97 526 122 Q 502 173 514 293 L 517 318 Q 521 364 531 415 Q 532 419 532 424 C 534 438 534 438 517 448 Z"}]]]
  )

(def red-chariot
  [:g {:id "red-chariot" :class "red-piece"}
   counter
   [:g {:transform "scale(0.0008, -0.001) translate(-550, -400)"}
    [:path {:d "M 244 513 Q 290 573 343 649 Q 374 701 401 727 Q 411 737 407 752 Q 403 767 373 792 Q 345 813 325 813 Q 304 812 313 788 Q 326 752 312 723 Q 237 558 52 353 Q 42 343 39 336 Q 35 323 50 326 Q 86 330 195 455 Q 198 462 216 480 L 244 513 Z"}]
    [:path {:d "M 216 480 Q 238 440 240 361 Q 240 237 213 123 Q 198 74 235 26 Q 236 23 240 20 Q 259 4 271 32 Q 286 74 286 122 Q 286 369 294 425 Q 301 453 291 464 Q 273 486 259 500 Q 252 507 244 513 C 221 532 203 507 216 480 Z"}]]
   [:g {:transform "scale(0.0009, -0.0008) translate(-370, -400)"}
    [:path {:d "M 552 695 Q 610 707 671 717 Q 723 729 730 735 Q 740 742 735 752 Q 728 764 698 772 Q 667 779 637 768 Q 595 755 553 743 L 490 729 Q 429 719 363 713 Q 326 709 352 690 Q 391 666 464 680 Q 476 683 490 683 L 552 695 Z"}]
    [:path {:d "M 317 580 Q 293 592 270 595 Q 263 596 257 591 Q 250 584 261 573 Q 294 534 319 403 Q 326 337 368 312 Q 369 312 371 311 Q 386 308 388 330 L 385 364 Q 381 388 372 413 Q 353 518 349 541 C 344 567 344 567 317 580 Z"}]
    [:path {:d "M 655 361 Q 655 358 657 354 Q 661 336 676 337 Q 692 338 701 354 Q 717 372 746 461 Q 767 519 808 551 Q 830 569 813 587 Q 794 606 737 638 Q 719 651 650 633 Q 598 630 549 619 L 490 609 Q 460 605 435 599 Q 365 586 317 580 C 287 576 320 533 349 541 Q 400 557 491 571 L 549 580 Q 678 601 701 589 Q 711 582 704 547 Q 674 418 660 390 L 655 361 Z"}]
    [:path {:d "M 549 466 Q 586 473 622 476 Q 644 479 637 492 Q 627 507 601 513 Q 582 517 549 509 L 492 495 Q 449 485 412 477 Q 396 473 415 458 Q 425 451 446 453 Q 468 457 492 459 L 549 466 Z"}]
    [:path {:d "M 550 352 Q 595 358 655 361 C 685 363 686 375 660 390 Q 630 412 549 391 L 493 380 Q 435 370 385 364 C 355 360 358 329 388 330 Q 395 330 403 331 Q 437 340 493 345 L 550 352 Z"}]
    [:path {:d "M 551 225 Q 630 231 900 232 Q 925 231 931 242 Q 938 257 918 274 Q 839 334 793 311 Q 697 295 551 273 L 492 264 Q 323 245 124 223 Q 97 222 117 199 Q 159 160 203 173 Q 374 218 461 218 Q 474 221 492 220 L 551 225 Z"}]
    [:path {:d "M 492 220 Q 483 43 500 -38 Q 503 -56 511 -68 Q 527 -84 536 -61 Q 552 -22 551 225 L 551 273 Q 550 310 550 352 L 549 391 Q 549 431 549 466 L 549 509 Q 549 546 549 580 L 549 619 Q 550 662 552 695 L 553 743 Q 553 744 554 745 Q 555 781 574 812 Q 581 830 559 846 Q 532 867 486 878 Q 465 884 451 868 Q 441 859 455 846 Q 486 819 489 781 Q 489 759 490 729 L 490 683 Q 490 650 490 609 L 491 571 Q 491 537 492 495 L 492 459 Q 492 420 493 380 L 493 345 Q 493 302 492 264 L 492 220 Z"}]]])

(def black-chariot
  [:g {:id "black-chariot" :class "black-piece"}
   counter
   [:g {:transform "scale(0.001, -0.001) translate(-500, -400)"}
    [:path {:d "M 552 695 Q 610 707 671 717 Q 723 729 730 735 Q 740 742 735 752 Q 728 764 698 772 Q 667 779 637 768 Q 595 755 553 743 L 490 729 Q 429 719 363 713 Q 326 709 352 690 Q 391 666 464 680 Q 476 683 490 683 L 552 695 Z"}]
    [:path {:d "M 317 580 Q 293 592 270 595 Q 263 596 257 591 Q 250 584 261 573 Q 294 534 319 403 Q 326 337 368 312 Q 369 312 371 311 Q 386 308 388 330 L 385 364 Q 381 388 372 413 Q 353 518 349 541 C 344 567 344 567 317 580 Z"}]
    [:path {:d "M 655 361 Q 655 358 657 354 Q 661 336 676 337 Q 692 338 701 354 Q 717 372 746 461 Q 767 519 808 551 Q 830 569 813 587 Q 794 606 737 638 Q 719 651 650 633 Q 598 630 549 619 L 490 609 Q 460 605 435 599 Q 365 586 317 580 C 287 576 320 533 349 541 Q 400 557 491 571 L 549 580 Q 678 601 701 589 Q 711 582 704 547 Q 674 418 660 390 L 655 361 Z"}]
    [:path {:d "M 549 466 Q 586 473 622 476 Q 644 479 637 492 Q 627 507 601 513 Q 582 517 549 509 L 492 495 Q 449 485 412 477 Q 396 473 415 458 Q 425 451 446 453 Q 468 457 492 459 L 549 466 Z"}]
    [:path {:d "M 550 352 Q 595 358 655 361 C 685 363 686 375 660 390 Q 630 412 549 391 L 493 380 Q 435 370 385 364 C 355 360 358 329 388 330 Q 395 330 403 331 Q 437 340 493 345 L 550 352 Z"}]
    [:path {:d "M 551 225 Q 630 231 900 232 Q 925 231 931 242 Q 938 257 918 274 Q 839 334 793 311 Q 697 295 551 273 L 492 264 Q 323 245 124 223 Q 97 222 117 199 Q 159 160 203 173 Q 374 218 461 218 Q 474 221 492 220 L 551 225 Z"}]
    [:path {:d "M 492 220 Q 483 43 500 -38 Q 503 -56 511 -68 Q 527 -84 536 -61 Q 552 -22 551 225 L 551 273 Q 550 310 550 352 L 549 391 Q 549 431 549 466 L 549 509 Q 549 546 549 580 L 549 619 Q 550 662 552 695 L 553 743 Q 553 744 554 745 Q 555 781 574 812 Q 581 830 559 846 Q 532 867 486 878 Q 465 884 451 868 Q 441 859 455 846 Q 486 819 489 781 Q 489 759 490 729 L 490 683 Q 490 650 490 609 L 491 571 Q 491 537 492 495 L 492 459 Q 492 420 493 380 L 493 345 Q 493 302 492 264 L 492 220 Z"}]]]
  )

(def red-horse
  [:g {:id "red-horse" :class "red-piece"}
   counter
   [:g {:transform "scale(0.0008, -0.001) translate(-530, -400)"}
    [:path {:d "M 244 513 Q 290 573 343 649 Q 374 701 401 727 Q 411 737 407 752 Q 403 767 373 792 Q 345 813 325 813 Q 304 812 313 788 Q 326 752 312 723 Q 237 558 52 353 Q 42 343 39 336 Q 35 323 50 326 Q 86 330 195 455 Q 198 462 216 480 L 244 513 Z"}]
    [:path {:d "M 216 480 Q 238 440 240 361 Q 240 237 213 123 Q 198 74 235 26 Q 236 23 240 20 Q 259 4 271 32 Q 286 74 286 122 Q 286 369 294 425 Q 301 453 291 464 Q 273 486 259 500 Q 252 507 244 513 C 221 532 203 507 216 480 Z"}]
    ]
   [:g {:transform "scale(0.00075, -0.0008) translate(-325, -400)"}
    [:path {:d "M 548 771 Q 737 807 742 810 Q 749 817 746 825 Q 740 837 714 844 Q 693 850 582 820 Q 465 796 366 789 Q 363 789 361 787 C 332 781 350 760 380 757 Q 396 753 490 762 Q 493 763 498 763 L 548 771 Z"}]
    [:path {:d "M 361 787 Q 357 791 350 795 Q 313 820 293 823 Q 278 822 275 811 Q 272 799 282 790 Q 298 763 302 742 Q 317 582 286 407 Q 279 382 280 377 Q 281 367 296 355 Q 312 342 319 340 C 345 325 355 398 353 428 Q 349 456 355 606 Q 365 730 373 742 Q 377 749 380 757 C 386 769 385 769 361 787 Z"}]
    [:path {:d "M 566 641 Q 669 668 671 669 Q 678 676 675 683 Q 668 692 645 697 Q 615 703 567 681 L 513 666 Q 479 659 438 654 Q 410 648 430 635 Q 463 617 509 629 Q 510 630 513 629 L 566 641 Z"}]
    [:path {:d "M 561 518 Q 598 528 638 536 Q 671 545 675 549 Q 682 556 679 563 Q 672 572 649 577 Q 625 581 562 557 L 513 544 Q 471 537 426 530 Q 398 526 418 512 Q 445 499 510 508 Q 511 508 513 508 L 561 518 Z"}]
    [:path {:d "M 562 557 Q 563 602 566 641 L 567 681 Q 567 699 570 726 Q 577 747 549 770 L 548 771 C 526 791 487 791 498 763 Q 508 745 513 666 L 513 629 Q 513 595 513 544 L 513 508 Q 514 471 514 427 C 514 397 558 403 559 433 Q 560 478 561 518 L 562 557 Z"}]
    [:path {:d "M 319 340 Q 496 406 765 418 Q 780 417 797 408 Q 810 398 808 379 Q 809 361 782 205 Q 761 112 739 78 Q 729 56 703 58 Q 675 67 647 74 Q 628 81 624 77 Q 620 71 637 58 Q 698 -21 702 -45 Q 706 -55 717 -57 Q 735 -61 771 -26 Q 805 8 817 52 Q 881 374 904 390 Q 914 397 913 405 Q 914 414 879 441 Q 831 471 800 461 Q 776 458 750 455 Q 669 455 559 433 L 514 427 Q 441 418 392 405 Q 355 401 353 428 C 332 450 291 330 319 340 Z"}]
    [:path {:d "M 184 301 Q 174 243 152 187 Q 140 150 166 118 Q 178 102 196 120 Q 215 142 222 177 Q 229 217 223 249 Q 222 283 208 307 Q 201 314 195 314 Q 186 310 184 301 Z"}]
    [:path {:d "M 304 255 Q 314 195 331 174 Q 340 165 352 171 Q 362 177 368 190 Q 375 229 333 273 Q 332 276 330 277 Q 320 287 312 289 Q 308 290 304 281 Q 300 272 304 255 Z"}]
    [:path {:d "M 423 278 Q 441 229 465 204 Q 477 197 488 206 Q 497 215 499 229 Q 500 251 490 267 Q 475 288 444 306 Q 432 315 423 314 Q 417 315 416 304 Q 415 294 423 278 Z"}]
    [:path {:d "M 565 311 Q 593 248 622 223 Q 635 216 647 226 Q 657 236 659 253 Q 659 295 588 342 L 587 343 Q 574 352 563 351 Q 557 351 556 339 Q 555 329 565 311 Z"}]]])

(def black-horse
  [:g {:id "black-horse" :class "black-piece"}
   counter
   [:g {:transform "scale(0.001, -0.001) translate(-500, -400)"}
    [:path {:d "M 548 771 Q 737 807 742 810 Q 749 817 746 825 Q 740 837 714 844 Q 693 850 582 820 Q 465 796 366 789 Q 363 789 361 787 C 332 781 350 760 380 757 Q 396 753 490 762 Q 493 763 498 763 L 548 771 Z"}]
    [:path {:d "M 361 787 Q 357 791 350 795 Q 313 820 293 823 Q 278 822 275 811 Q 272 799 282 790 Q 298 763 302 742 Q 317 582 286 407 Q 279 382 280 377 Q 281 367 296 355 Q 312 342 319 340 C 345 325 355 398 353 428 Q 349 456 355 606 Q 365 730 373 742 Q 377 749 380 757 C 386 769 385 769 361 787 Z"}]
    [:path {:d "M 566 641 Q 669 668 671 669 Q 678 676 675 683 Q 668 692 645 697 Q 615 703 567 681 L 513 666 Q 479 659 438 654 Q 410 648 430 635 Q 463 617 509 629 Q 510 630 513 629 L 566 641 Z"}]
    [:path {:d "M 561 518 Q 598 528 638 536 Q 671 545 675 549 Q 682 556 679 563 Q 672 572 649 577 Q 625 581 562 557 L 513 544 Q 471 537 426 530 Q 398 526 418 512 Q 445 499 510 508 Q 511 508 513 508 L 561 518 Z"}]
    [:path {:d "M 562 557 Q 563 602 566 641 L 567 681 Q 567 699 570 726 Q 577 747 549 770 L 548 771 C 526 791 487 791 498 763 Q 508 745 513 666 L 513 629 Q 513 595 513 544 L 513 508 Q 514 471 514 427 C 514 397 558 403 559 433 Q 560 478 561 518 L 562 557 Z"}]
    [:path {:d "M 319 340 Q 496 406 765 418 Q 780 417 797 408 Q 810 398 808 379 Q 809 361 782 205 Q 761 112 739 78 Q 729 56 703 58 Q 675 67 647 74 Q 628 81 624 77 Q 620 71 637 58 Q 698 -21 702 -45 Q 706 -55 717 -57 Q 735 -61 771 -26 Q 805 8 817 52 Q 881 374 904 390 Q 914 397 913 405 Q 914 414 879 441 Q 831 471 800 461 Q 776 458 750 455 Q 669 455 559 433 L 514 427 Q 441 418 392 405 Q 355 401 353 428 C 332 450 291 330 319 340 Z"}]
    [:path {:d "M 184 301 Q 174 243 152 187 Q 140 150 166 118 Q 178 102 196 120 Q 215 142 222 177 Q 229 217 223 249 Q 222 283 208 307 Q 201 314 195 314 Q 186 310 184 301 Z"}]
    [:path {:d "M 304 255 Q 314 195 331 174 Q 340 165 352 171 Q 362 177 368 190 Q 375 229 333 273 Q 332 276 330 277 Q 320 287 312 289 Q 308 290 304 281 Q 300 272 304 255 Z"}]
    [:path {:d "M 423 278 Q 441 229 465 204 Q 477 197 488 206 Q 497 215 499 229 Q 500 251 490 267 Q 475 288 444 306 Q 432 315 423 314 Q 417 315 416 304 Q 415 294 423 278 Z"}]
    [:path {:d "M 565 311 Q 593 248 622 223 Q 635 216 647 226 Q 657 236 659 253 Q 659 295 588 342 L 587 343 Q 574 352 563 351 Q 557 351 556 339 Q 555 329 565 311 Z"}]]])

(def red-minister
  [:g {:id "red-minister" :class "red-piece"}
   counter
   [:g {:transform "scale(0.001, -0.001) translate(-500, -400)"}
    [:path {:d "M 362 508 Q 387 515 418 521 Q 467 533 475 540 Q 485 549 480 559 Q 471 572 438 580 Q 398 586 364 570 L 317 553 Q 164 517 107 510 Q 65 503 95 484 Q 143 457 206 474 Q 249 484 297 493 L 362 508 Z"}]
    [:path {:d "M 359 419 Q 360 462 362 508 L 364 570 Q 364 681 387 761 Q 400 788 375 806 Q 359 818 329 837 Q 304 856 283 839 Q 277 835 284 818 Q 317 767 317 717 Q 318 644 318 559 Q 317 558 317 553 L 312 407 Q 305 214 299 181 Q 292 141 280 101 Q 268 59 294 -5 Q 301 -23 309 -27 Q 316 -34 324 -25 Q 351 -7 353 59 Q 352 101 358 387 L 359 419 Z"}]
    [:path {:d "M 297 493 Q 234 358 59 160 Q 52 150 64 147 Q 88 143 209 267 Q 263 322 312 407 C 376 516 310 520 297 493 Z"}]
    [:path {:d "M 358 387 Q 362 383 371 376 Q 402 351 434 320 Q 446 308 459 309 Q 469 309 473 321 Q 477 334 470 359 Q 461 389 367 418 Q 364 419 359 419 C 329 421 336 407 358 387 Z"}]
    [:path {:d "M 580 609 Q 559 625 535 632 Q 526 633 520 625 Q 516 619 524 609 Q 575 498 542 241 Q 536 207 525 169 Q 518 142 523 123 Q 533 89 544 76 Q 556 63 566 77 Q 578 89 583 124 L 589 160 Q 592 190 593 282 L 593 314 Q 593 368 593 423 L 593 453 Q 593 544 598 576 C 600 595 600 595 580 609 Z"}]
    [:path {:d "M 742 138 Q 773 101 795 65 Q 805 46 816 47 Q 834 48 849 84 Q 868 124 863 173 Q 851 300 842 534 Q 841 567 858 589 Q 868 602 858 614 Q 839 633 783 658 Q 764 668 748 658 Q 715 642 580 609 C 551 602 568 571 598 576 Q 604 576 741 603 Q 760 607 769 599 Q 805 571 788 184 Q 787 180 787 175 Q 784 163 775 161 C 760 135 731 152 742 138 Z"}]
    [:path {:d "M 593 423 Q 594 423 598 423 Q 671 435 726 442 Q 751 446 741 460 Q 729 475 703 479 Q 670 482 593 453 C 565 443 563 423 593 423 Z"}]
    [:path {:d "M 593 282 Q 597 282 603 282 Q 675 291 728 295 Q 756 299 745 315 Q 733 331 703 337 Q 655 344 593 314 C 566 301 563 282 593 282 Z"}]
    [:path {:d "M 583 124 Q 673 134 742 138 C 772 140 792 141 775 161 Q 763 177 736 183 Q 700 190 589 160 C 560 152 553 121 583 124 Z"}]]]
  )

(def black-elephant
  [:g {:id "black-elephant" :class "black-piece"}
   counter
   [:g {:transform "scale(0.001, -0.001) translate(-500, -400)"}
    [:path {:d "M 448 771 Q 457 780 465 785 Q 474 791 472 802 Q 471 812 452 833 Q 434 851 420 853 Q 407 854 409 836 Q 415 811 358 738 Q 330 705 293 670 Q 284 664 282 660 Q 278 651 288 652 Q 324 652 428 751 L 448 771 Z"}]
    [:path {:d "M 518 653 Q 603 723 635 737 Q 654 746 643 760 Q 631 773 596 798 Q 580 805 565 797 Q 556 793 481 776 Q 465 773 448 771 C 418 767 399 760 428 751 Q 449 741 531 752 Q 540 753 542 750 Q 545 747 540 740 Q 509 683 488 657 Q 484 653 482 648 C 466 623 495 634 518 653 Z"}]
    [:path {:d "M 261 614 Q 248 618 228 619 Q 215 622 213 616 Q 207 609 217 594 Q 242 552 264 481 Q 268 459 283 446 Q 302 425 306 442 Q 307 448 308 455 L 305 485 Q 305 486 305 489 Q 290 556 286 581 C 281 609 281 609 261 614 Z"}]
    [:path {:d "M 631 494 L 632 492 Q 636 476 648 476 Q 661 477 669 490 Q 676 494 694 517 Q 713 566 751 592 Q 770 605 755 622 Q 739 640 693 668 Q 678 678 599 663 Q 578 663 518 653 L 482 648 Q 430 642 383 633 Q 311 620 261 614 C 231 610 257 572 286 581 Q 346 600 450 615 L 492 620 Q 639 641 662 629 Q 668 625 663 607 Q 645 538 636 523 C 627 501 627 501 631 494 Z"}]
    [:path {:d "M 450 475 Q 526 487 631 494 C 661 496 661 507 636 523 Q 612 547 497 516 Q 482 515 469 510 L 416 500 Q 358 493 305 485 C 275 481 278 451 308 455 L 395 468 L 450 475 Z"}]
    [:path {:d "M 428 442 Q 438 458 450 475 L 469 510 Q 476 523 484 538 Q 517 593 515 599 Q 511 606 492 620 C 468 638 452 645 450 615 Q 449 572 429 526 Q 423 514 416 500 L 395 468 Q 323 381 255 330 Q 233 315 205 295 Q 198 289 203 286 Q 209 283 219 287 Q 342 329 412 420 L 428 442 Z"}]
    [:path {:d "M 556 316 Q 523 374 470 415 Q 443 437 428 442 C 401 456 388 439 412 420 Q 413 419 417 416 Q 430 406 444 394 L 486 350 Q 495 338 504 324 L 532 267 Q 553 194 520 87 Q 508 51 497 47 Q 484 41 410 58 Q 370 67 368 60 Q 367 53 379 40 Q 451 -12 481 -48 Q 494 -64 507 -61 Q 526 -58 544 -33 Q 593 49 590 187 Q 580 250 578 256 L 556 316 Z"}]
    [:path {:d "M 444 394 Q 423 313 197 177 Q 179 167 201 168 Q 282 168 435 303 Q 441 309 486 350 C 508 370 454 422 444 394 Z"}]
    [:path {:d "M 504 324 Q 411 179 189 51 Q 176 41 184 37 Q 193 31 206 35 Q 338 65 483 212 Q 529 258 528 261 Q 529 264 532 267 C 548 292 521 349 504 324 Z"}]
    [:path {:d "M 574 302 Q 671 360 720 381 Q 739 384 736 396 Q 732 412 714 434 Q 696 455 673 459 Q 658 460 657 440 Q 658 418 556 316 C 535 295 548 287 574 302 Z"}]
    [:path {:d "M 578 256 Q 645 181 719 111 Q 743 87 782 87 Q 854 86 928 102 Q 947 105 948 110 Q 951 117 935 123 Q 758 180 733 194 Q 730 197 727 198 Q 663 231 574 302 C 549 322 518 323 578 256 Z"}]]]
  )

(def red-guard
  [:g {:id "red-guard" :class "red-piece"}
   counter
   [:g {:transform "scale(0.001, -0.001) translate(-500, -400)"}
    [:path {:d "M 244 513 Q 290 573 343 649 Q 374 701 401 727 Q 411 737 407 752 Q 403 767 373 792 Q 345 813 325 813 Q 304 812 313 788 Q 326 752 312 723 Q 237 558 52 353 Q 42 343 39 336 Q 35 323 50 326 Q 86 330 195 455 Q 198 462 216 480 L 244 513 Z"}]
    [:path {:d "M 216 480 Q 238 440 240 361 Q 240 237 213 123 Q 198 74 235 26 Q 236 23 240 20 Q 259 4 271 32 Q 286 74 286 122 Q 286 369 294 425 Q 301 453 291 464 Q 273 486 259 500 Q 252 507 244 513 C 221 532 203 507 216 480 Z"}]
    [:path {:d "M 648 425 Q 673 431 881 463 Q 894 462 905 476 Q 906 491 879 502 Q 837 526 778 507 Q 717 491 657 475 Q 653 475 649 472 L 597 461 Q 531 451 361 426 Q 327 422 353 401 Q 392 371 437 382 Q 509 400 597 415 L 648 425 Z"}]
    [:path {:d "M 640 191 Q 644 312 648 425 L 649 472 Q 649 616 676 733 Q 680 746 655 764 Q 612 786 583 790 Q 564 794 554 784 Q 545 774 555 756 Q 591 707 591 671 Q 595 571 597 461 L 597 415 Q 596 304 591 183 C 590 153 639 161 640 191 Z"}]
    [:path {:d "M 591 183 Q 503 170 400 154 Q 379 153 395 135 Q 426 107 465 116 Q 597 150 835 151 Q 854 152 860 160 Q 864 172 848 186 Q 788 228 731 209 Q 692 202 640 191 L 591 183 Z"}]]]
  )

(def black-guard
  [:g {:id "black-guard" :class "black-piece"}
   counter
   [:g {:transform "scale(0.001, -0.001) translate(-500, -400)"}
    [:path {:d "M 535 412 Q 718 436 872 423 Q 897 420 903 430 Q 910 443 898 456 Q 867 484 821 504 Q 806 510 779 501 Q 713 485 645 475 Q 581 468 536 461 L 482 454 Q 473 457 297 431 Q 231 421 132 418 Q 119 417 117 406 Q 116 393 136 378 Q 154 365 186 353 Q 198 349 216 358 Q 232 364 302 377 Q 383 396 482 407 L 535 412 Z"}]
    [:path {:d "M 530 159 Q 533 292 535 412 L 536 461 Q 536 650 554 701 Q 566 723 551 736 Q 514 764 484 773 Q 468 777 453 764 Q 447 757 454 745 Q 484 697 482 642 Q 482 551 482 454 L 482 407 Q 482 284 482 153 C 482 123 529 129 530 159 Z"}]
    [:path {:d "M 482 153 Q 386 141 274 128 Q 252 127 268 107 Q 284 91 303 85 Q 327 78 344 83 Q 443 108 704 108 Q 717 108 731 107 Q 753 106 759 116 Q 765 129 747 144 Q 684 192 614 174 Q 578 168 530 159 L 482 153 Z"}]]]
  )

(def red-marshal
  [:g {:id "red-marshal" :class "red-piece"}
   counter
   [:g {:transform "scale(0.001, -0.001) translate(-500, -400)"}
    [:path {:d "M 236 580 Q 278 629 302 662 Q 351 735 374 754 Q 392 770 376 784 Q 357 797 328 803 Q 301 809 289 803 Q 277 797 285 786 Q 300 755 218 583 Q 217 583 217 582 C 203 556 217 557 236 580 Z"}]
    [:path {:d "M 222 320 Q 222 375 224 416 L 225 444 Q 225 543 229 548 C 232 570 232 570 217 582 Q 202 597 180 604 Q 170 608 158 605 Q 151 599 157 587 Q 176 517 178 494 Q 190 290 159 168 Q 144 113 181 66 Q 191 53 203 65 Q 213 80 219 144 L 220 176 Q 220 260 221 292 L 222 320 Z"}]
    [:path {:d "M 407 478 Q 431 548 459 565 Q 474 581 460 597 Q 394 651 344 618 Q 314 606 236 580 C 208 570 180 538 229 548 Q 239 549 253 555 Q 307 568 358 583 Q 371 587 377 582 Q 384 575 382 558 Q 372 515 361 481 C 352 452 397 450 407 478 Z"}]
    [:path {:d "M 224 416 Q 240 412 256 415 Q 308 430 422 445 Q 432 446 433 456 Q 433 463 407 478 L 361 481 Q 357 481 355 480 Q 283 456 225 444 C 196 438 195 422 224 416 Z"}]
    [:path {:d "M 406 204 Q 430 271 458 296 Q 474 314 459 330 Q 387 384 335 353 Q 263 329 222 320 C 193 313 191 289 221 292 Q 230 291 354 316 Q 364 317 370 314 Q 377 307 376 291 Q 367 245 357 207 C 350 178 396 176 406 204 Z"}]
    [:path {:d "M 219 144 Q 229 141 243 145 Q 298 158 420 169 Q 430 170 432 179 Q 432 188 406 204 C 391 213 387 212 357 207 L 355 207 Q 280 188 220 176 C 191 170 189 149 219 144 Z"}]
    [:path {:d "M 546 529 Q 528 547 497 544 Q 484 540 490 529 Q 526 457 496 346 Q 472 304 506 258 L 508 256 Q 515 243 524 249 Q 552 270 553 349 Q 554 466 557 495 C 559 518 559 518 546 529 Z"}]
    [:path {:d "M 704 523 Q 806 544 819 531 Q 835 518 833 472 Q 830 427 828 371 Q 828 331 814 315 Q 808 303 784 309 Q 765 312 744 315 Q 728 319 723 313 Q 719 309 734 298 Q 786 258 816 223 Q 832 208 852 216 Q 865 222 875 252 Q 897 298 894 357 Q 885 484 897 527 Q 904 543 898 552 Q 876 567 841 581 Q 822 588 807 582 Q 773 566 705 554 L 648 542 Q 602 535 546 529 C 516 526 527 492 557 495 Q 564 495 573 496 Q 613 505 648 511 L 704 523 Z"}]
    [:path {:d "M 648 511 Q 648 235 643 148 Q 640 -42 660 -72 Q 675 -88 684 -66 Q 703 -21 702 332 Q 702 441 704 523 L 705 554 Q 706 647 711 702 Q 712 736 731 766 Q 738 782 717 799 Q 692 818 647 831 Q 626 835 613 821 Q 603 814 616 800 Q 647 775 649 738 Q 649 665 648 542 L 648 511 Z"}]]]
  )

(def black-general
  [:g {:id "black-general" :class "black-piece"}
   counter
   [:g {:transform "scale(0.001, -0.001) translate(-500, -400)"}
    [:path {:d "M 343 556 Q 235 535 233 537 Q 224 546 239 658 Q 248 679 193 706 Q 175 715 166 711 Q 154 705 164 690 Q 189 650 187 593 Q 187 547 174 523 Q 165 504 176 483 Q 191 459 207 471 Q 250 492 343 526 C 371 536 372 562 343 556 Z"}]
    [:path {:d "M 339 375 Q 335 213 325 159 Q 307 69 321 32 Q 324 25 328 14 Q 335 -4 343 -7 Q 349 -14 356 -5 Q 363 -1 373 19 Q 379 34 382 176 Q 382 402 386 407 Q 385 408 384 408 Q 385 484 387 577 Q 388 671 406 734 Q 415 749 411 762 Q 405 772 350 805 Q 328 821 307 806 Q 303 802 309 786 Q 340 740 341 692 Q 342 629 343 556 L 343 526 Q 342 466 340 402 L 339 375 Z"}]
    [:path {:d "M 221 334 Q 312 367 339 375 C 368 384 369 408 340 402 Q 109 351 73 354 Q 61 353 59 344 Q 56 332 64 324 Q 83 308 112 289 Q 121 285 132 292 Q 157 308 185 320 L 221 334 Z"}]
    [:path {:d "M 185 320 Q 191 314 189 286 Q 174 178 75 34 Q 71 30 71 23 Q 72 19 77 19 Q 143 46 234 236 Q 234 245 256 284 Q 260 294 252 306 Q 236 325 221 334 C 196 351 175 348 185 320 Z"}]
    [:path {:d "M 643 713 Q 658 726 675 743 Q 691 762 706 771 Q 715 778 713 791 Q 712 801 691 825 Q 672 844 656 847 Q 640 848 644 829 Q 651 799 586 720 Q 555 684 514 645 Q 504 638 501 633 Q 497 624 509 624 Q 530 624 626 698 L 643 713 Z"}]
    [:path {:d "M 626 698 Q 648 676 735 692 Q 753 701 761 688 Q 764 682 752 668 Q 665 544 435 408 Q 420 399 433 396 Q 509 396 690 532 Q 693 536 697 538 Q 751 583 805 638 Q 827 662 862 683 Q 877 692 873 701 Q 872 710 819 739 Q 803 751 784 740 Q 762 730 731 724 Q 685 717 643 713 C 613 710 605 709 626 698 Z"}]
    [:path {:d "M 596 630 Q 606 615 620 601 Q 635 588 648 589 Q 660 588 664 604 Q 665 614 656 631 Q 638 652 598 652 Q 591 653 590 643 Q 589 636 596 630 Z"}]
    [:path {:d "M 481 570 Q 532 516 554 516 Q 567 515 572 534 Q 572 547 562 565 Q 543 590 484 597 Q 474 598 475 586 Q 474 579 481 570 Z"}]
    [:path {:d "M 753 363 Q 816 369 898 371 Q 953 371 960 381 Q 964 391 949 403 Q 894 440 836 420 Q 800 414 757 402 L 699 391 Q 686 390 673 387 Q 564 369 434 348 Q 416 347 430 331 Q 443 319 459 315 Q 478 311 493 315 Q 589 345 700 357 L 753 363 Z"}]
    [:path {:d "M 700 357 Q 712 89 687 66 Q 677 59 663 63 Q 632 67 603 72 Q 590 73 591 66 Q 592 59 603 51 Q 675 -10 698 -45 Q 714 -61 730 -47 Q 761 -14 762 70 Q 753 166 753 363 L 757 402 Q 758 420 765 433 Q 774 452 756 466 Q 729 488 698 499 Q 679 506 670 497 Q 664 490 675 474 Q 699 435 699 391 L 700 357 Z"}]
    [:path {:d "M 500 219 Q 524 192 548 161 Q 560 146 575 145 Q 585 144 593 157 Q 600 170 595 202 Q 588 235 502 267 Q 487 273 480 271 Q 474 268 475 255 Q 476 243 500 219 Z"}]]])

(defn complete-move
  [router-history svg opened-move {:move/keys [next-board]}]
  (update svg 1 assoc
    :class
    (board-layout/opened-move-classes (:player @opened-move))

    :onClick
    (fn []
      (reset! opened-move nil)
      (.push router-history next-board)
      (xf/dispatch [:uix.control-board/fetch-board next-board]))))

(defn did-piece-open-move?
  [opened-move piece]
  (when-let [{:keys [opened-x opened-y]} @opened-move]
    (and
      (= (:x piece) opened-x)
      (= (:y piece) opened-y))))

(defn open-move
  [opened-move svg piece]
  (if (empty? (:piece/moves piece))
    svg
    (update svg 1 assoc
      :onClick
      (fn [] (swap! opened-move #(when-not (= piece %) piece))))))

(defn layout-board
  [{:keys [disposition board-ident] :as board-desc}]
  (let [board-state (uix/state {:opened-move nil})
        opened-move (uix/cursor-in board-state [:opened-move])
        history (router/useHistory)]
    (board-layout/layout-pieces
      {:openmove-fn #(open-move opened-move %1 %2)
       :completemove-fn #(complete-move history %1 %2 %3)
       :did-piece-open-move?-fn #(did-piece-open-move? opened-move %1)}
      disposition
      opened-move
      (:piece/moves @opened-move))))

(defn draw-board
  []
  (let [board-desc (<sub [:uix.control-board/board-description])]
    [:svg#outer-svg {:viewBox "0 0 900 1000"
                     :width "100px"
                     :preserveAspectRatio "xMinYMin meet"}
     [:defs
      board-lines chu river han border
      red-soldier red-cannon red-chariot red-horse
      red-minister red-guard red-marshal
      black-private black-catapult black-chariot black-horse
      black-elephant black-guard black-general]
     [:g {:id "main-board" :transform "scale(100,100) translate(0.5,0.5)"}
      [:use {:href "#board-lines" :x 0 :y 0}]
      [:use {:href "#chu" :x 7 :y 4.5 :transform "rotate(90,7,4.5)"}]
      [:use {:href "#river" :x 5.5 :y 4.5 :transform "rotate(90,5.5,4.5)"}]
      [:use {:href "#border" :y 4.5 :x 2.5 :transform "rotate(270,2.5,4.5)"}]
      [:use {:href "#han" :y 4.5 :x 1 :transform "rotate(270,1,4.5)"}]
      [player-boundary board-desc]
      [layout-board board-desc]
      ]]))
